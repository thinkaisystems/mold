<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Parser - Model</title>

    <!-- Bootstrap Core CSS -->
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="/vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="/vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link href="/sortablefiles/ply.css" rel="stylesheet" type="text/css">

    <link href="/sortablefiles/app.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link href="/stylesheets/slider.css" rel="stylesheet" type="text/css">

<link href="/stylesheets/style-model.css" rel="stylesheet" type="text/css">

    <style>
        #divPleasewait {
            position: absolute;
            top: 193px;
            left: 460px;
            width: 80%;
            height: 80%;
            /* background-color: #60E; */
            /* background-image: url(ajax-loader.gif); */
            background-repeat: no-repeat;
            background-position: center;
            z-index: 10000000;
            /* opacity: 0.4; */
        }
    </style>

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../../index.html">Parser</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>User Name</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>We are intrested in .....</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="../../index.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
                        </li>
						<li>
                            <a href="../../connection-list"><i class="fa fa-cubes fa-fw"></i> Connections</a>
                        </li>
						
												
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="container" style="">
                <!-- padding: 80px 150px 0; height: 160px;-->
                <div style="padding: 80px 150px 0">
                    <!--<a class="logo" href="#"><img src="logo.png"></a>
                     <h1 data-force="40" data-force-y="2.5">TESMP&nbsp;TEST.</h1> -->
                </div>
            </div>

			<div class="container custom-con">
			<h3><a href="/model-list">Model List</a></h3>
			<h1>Model Detail</h1>
			<table>
			<tbody>
			<tr>
			<td>ModelName</td>
			<td>:</td>
			<td><%= model.ModelName %></td>
			</tr>
			<tr>
			<td>ConId</td>
			<td>:</td>
			<td><%= model.ConId %></td>
			</tr>
			<tr>
			<td>InfluencingFields</td>
			<td>:</td>
			<td><%= model.FieldsSelected %></td>
			</tr>
			<tr>
			<td>ModelType</td>
			<td>:</td>
			<td><%= model.ModelType %></td>
			</tr>
			</tbody>
			</table>
			<h3><a href="/models/edit/<%= model._id%>">EDIT</a></h3>
			<form action="/models/delete/<%= model._id%>" method="post">
			<button type="submit">DELETE</button>
			</form>
			</div>
			
			<br/><br/>
			<button name="btnTensorBoard" id="btnTensorBoard" value="Tensor Board" type="button" class="nextButton">Tensor Board</button>
			<button name="btnNext" id="btnNext" value="Next" type="button" class="nextButton">Start Training</button>
			<button name="btnDashboard" id="btnDashboard" value="Training Dashboard" type="button" class="nextButton">Training Dashboard</button>
			<button name="btnStreamingDashboard" id="btnStreamingDashboard" value="Streaming Dashboard" type="button" class="nextButton">Streaming Dashboard</button>
						
			
            <!-- Connected lists -->
            
                
				
                
				
                <div id="divPleasewait">
                    <div>
                        <img src="/images/loader_seq.gif" />
                    </div>
                </div>

            

			<div class="feedback">
				<a id="logs_button">Logs</a>

				<div class="form">					
					<textarea name="txtMessage" id="txtMessage" rows="10" cols="140">----------LOGS------</textarea>
							<ul id="messages"></ul>			
				</div>
			</div>
			
			
        </div>
        <!-- /#wrapper -->
    </div>
        <!-- jQuery -->
        <script src="/vendor/jquery/jquery.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src="/vendor/metisMenu/metisMenu.min.js"></script>

        <!-- DataTables JavaScript -->
        <script src="/vendor/datatables/js/jquery.dataTables.min.js"></script>
        <script src="/vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
        <script src="/vendor/datatables-responsive/dataTables.responsive.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/dist/js/sb-admin-2.js"></script>

        <script src="/sortablefiles/Sortable.js"></script>

        <script src="/sortablefiles/app.js"></script>

        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
        <script type="text/javascript" src="/js/jquery.redirect.js"></script>
		<script type="text/javascript" src="/js/slider.js"></script>

        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io.connect("http://"+_global_parser_hostip+":"+_global_parser_hostport+"/")

            socket.on('news', function(data) {

							if (data.msg=='DONE' && data.count ==-1) 
							{
                                //window.location = data.redirectto;			  
                                $("#btnNext").show();
                                $("#divPleasewait").hide();
								$( "#logs_button" ).trigger( "click" );

                                //$.redirect(data.redirectto, {'arg1': 'value1', 'arg2': 'value2'},"GET",null,null,true);

                            }
							else if(data.msg=='FileWatchFoundFile' && data.count ==1155) {
								$('#btnTensorBoard').show();
							}	

                $("#txtMessage").val($("#txtMessage").val() + " \n " + data.msg);
                document.getElementById("txtMessage").scrollTop = document.getElementById("txtMessage").scrollHeight
            })

            socket.on('private', function(data) {
                var li = document.createElement('li'),
                    text = document.createTextNode('Private: ' + data.msg)

                li.appendChild(text)
                document.getElementById('messages').appendChild(li)

                socket.emit('private', {
                    msg: 'Thank you for your message'
                })
            })
        </script>

        <script>
            $(document).ready(function() {

                $("#divPleasewait").hide();
				$('#btnTensorBoard').hide();
				
                $("#txtMessage").val("");

                var configFieldList = "",_fieldConId,_fieldModelId;
                //$('#selFields li').each(function() { // id of ul
                    //console.log($(this).text());
                  //  configFieldList = $(this).text() + "," + configFieldList;
                //});
                //var configFieldNamesTemp = configFieldList.split(',');
                //var configFieldNames = configFieldNamesTemp.filter(function(v) {
                 //   return v !== ''
                //});
				
				configFieldList='<%= model.FieldsSelected %>';
				_fieldConId='<%= model.ConId %>';
				_fieldModelId='<%= model._id %>';

                console.log(configFieldList);
                //  $('.selectpicker').selectpicker();
                //console.log('READY');

                $('#btnNext').click(function() {

                    $("#btnNext").hide();
                    $("#divPleasewait").show();
					$( "#logs_button" ).trigger( "click" );
					
					fnStartFolderWatcher();
					
                    $.ajax({
                        type: 'POST',
                        url: '/python',
                        data: JSON.stringify({
                            filename: 'invoke-script',
                            config_field_name: configFieldList,
							ConId:_fieldConId,
							ModelId:_fieldModelId,

                        }),
                        beforeSend: function(xhr) {
                            $("#txtMessage").val("");
                        },
                        success: function(data) {
                            console.log(data);
                            if (typeof(data.redirectto) == 'string') 
							{
                                //window.location = data.redirectto;			  
                                $("#btnNext").show();
                                $("#divPleasewait").hide();
								$( "#logs_button" ).trigger( "click" );

                                //$.redirect(data.redirectto, {'arg1': 'value1', 'arg2': 'value2'},"GET",null,null,true);

                            }
                        },
                        contentType: "application/json",
                        dataType: 'json'
                    });

                });

                $('#uploadForm').submit(function() {
                    $("#status").empty().text("File is uploading...");
                    $(this).ajaxSubmit({
                        error: function(xhr) {
                            status('Error: ' + xhr.status);
                        },
                        success: function(response) {
                            console.log(response)
                            $("#status").empty().text(response);
                        }
                    });
                    return false;
                });

                //var autoDatasource=[{label: "",value: ""}];
                var autoDatasource = [{}];

                $.getJSON("http://"+_global_parser_hostip+":"+_global_parser_hostport+"/connection-api", function(data) {
						for (var i = 0; i < data.connections.length; i++) {
                        autoDatasource.push({
                            label: data.connections[i].ConName,
                            value: data.connections[i]._id
                        });
                    }
                });

                $("#connectionList").autocomplete({
                    source: autoDatasource,
                    focus: function(event, ui) {
                        // prevent autocomplete from updating the textbox
                        event.preventDefault();
                        // manually update the textbox
                        $(this).val(ui.item.label);
                    },
                    select: function(event, ui) {
                        // prevent autocomplete from updating the textbox
                        event.preventDefault();
                        // manually update the textbox and hidden field
                        $(this).val(ui.item.label);
                        $("#connectionList-value").val(ui.item.value);
												
                    }
                });
				
				
				
		$('#btnDashboard').click(function() {
		   window.open("http://"+_global_parser_hostip+":"+_global_parser_hostport+"/model-train.html?model-Id=<%= model._id %>", '_blank');
		});
			

		$('#btnStreamingDashboard').click(function() {
		   window.open("http://"+_global_parser_hostip+":"+_global_parser_hostport+"/model-stream.html?model-Id=<%= model._id %>&canReStream=true", '_blank');
		});			
				
		

		$('#btnTensorBoard').click(function() {
		   window.open("http://"+_global_parser_hostip+":6006/<%= model._id %>", '_blank');	
		});		
		
		
		
		function fnStartFolderWatcher(){
		
			$.ajax({
			type: 'POST',
			url: '/start-watch',
			data: JSON.stringify({				
				modelId:_fieldModelId,
			}),
			beforeSend: function(xhr) {
				//$("#txtMessage").val("");
				$('#btnTensorBoard').hide();
			},
			success: function(data) {
				console.log(data);				
			},
			contentType: "application/json",
			dataType: 'json'
			});
			
		}
		///////START initial watch
		fnStartFolderWatcher();
				
				
				/////////////////////////////////////////////////////////////////////

            });
        </script>

</body>

</html>